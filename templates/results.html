{% extends "base.html" %}

{% block content %}
<h1>QR Code Generation Results</h1>

{% if generated_files %}
    <div class="alert alert-success">
        Successfully generated {{ generated_files|length }} QR code(s)!
    </div>

    <div style="margin-bottom: 30px;">
        <a href="{{ url_for('download_all') }}" class="btn">Download All as ZIP</a>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Generate More</a>
        <a href="{{ url_for('clear_files') }}" class="btn btn-danger" 
           onclick="return confirm('Are you sure you want to clear all generated QR codes?')">
            Clear All
        </a>
    </div>

    <h3>Generated QR Codes:</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
        {% for email, filepath in generated_files %}
        <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background-color: #f9f9f9;">
            <h4 style="margin: 0 0 10px 0; color: #003896; font-size: 14px; word-break: break-all;">
                {{ email }}
            </h4>
            <img src="{{ url_for('serve_qr_code', filename=filepath.split('/')[-1]) }}" 
                 alt="QR Code for {{ email }}" 
                 style="max-width: 100%; height: auto; border: 1px solid #ccc; border-radius: 4px;"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div style="display: none; color: #666; font-style: italic; text-align: center; padding: 20px;">
                QR Code image not available for display
            </div>
            <p style="margin: 10px 0 0 0; font-size: 12px; color: #666;">
                Saved as: {{ filepath.split('/')[-1] }}
            </p>
        </div>
        {% endfor %}
    </div>
{% endif %}

{% if failed_emails %}
    <div class="alert alert-danger" style="margin-top: 30px;">
        <h4>Failed to generate QR codes for the following emails:</h4>
        <ul style="margin: 10px 0 0 20px;">
            {% for email in failed_emails %}
                <li>{{ email }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

{% if not generated_files and not failed_emails %}
    <div class="alert alert-danger">
        No QR codes were generated. Please check your input and try again.
    </div>
    <a href="{{ url_for('index') }}" class="btn">Try Again</a>
{% endif %}
{% endblock %}